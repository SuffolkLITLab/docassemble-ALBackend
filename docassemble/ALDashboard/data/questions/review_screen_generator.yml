metadata:
  title: |
    Generate a draft review screen
  temporary session: True
---
include:
  - nav.yml
---
modules:
  - .review_generator
---
mandatory: True
code: |
  yaml_file
  results
---
question: |
  Generate a review screen
subquestion: |
  This interview will build you a draft of a review screen from a YAML file containing
  a docassemble interview.
  
  Please make sure to upload any YAML files containing questions as well as any YAML
  files containing `objects` blocks.
fields:
  - Upload 1 or more YAML files: yaml_file
    datatype: files
  - note: |
      **List handling**

      By default, the first 3 items in a list will get their own inline row and
      edit button in the review screen. If there are more than 3 items in the
      list, they will be displayed in a table.

      You can set this number to "0" to put all list items in a table instead.
  - How many items in each list do you want to generate an inline review block for?: inline_review_blocks_to_generate
    datatype: range
    min: 0
    max: 10
    step: 1
    default: 3
  - note: |
      **Name and address blocks**

      If your interview does not include custom questions for name and address fields, we can add
      blocks for those fields for lists that we know can contain people.   
  - Add standard name and address review blocks for all ALPeopleList, PeopleList, PartyList, and ChildList objects?: add_name_address_review_blocks
    datatype: yesno
    default: True
    show if:
      variable: list_handling
      is: use_inline_review_blocks
validation code: |
  if defined("inline_review_blocks_to_generate"):
    inline_review_blocks_to_generate = int(inline_review_blocks_to_generate)
---
code: |
  parsed_yaml = parse_yaml(yaml_file)
  objects = get_objects(parsed_yaml)

  review_blocks, review_tables = get_question_review_blocks_and_tables(
      get_questions(parsed_yaml, objects),
      number_of_expansions=inline_review_blocks_to_generate, iterator="i"
  )

  review_yaml = [
      {
          "need": [table["table"] for table in review_tables],
          "id": "review screen",
          "question": "Review your answers",
          "review": [],
      },
  ]
  if add_name_address_review_blocks:
      review_yaml["review"].extend(
          get_name_and_address_review_blocks(
              objects, number_of_expansions=inline_review_blocks_to_generate
          )
      )
  review_yaml["review"].extend(review_blocks)
  if add_name_address_review_blocks:
      review_yaml["review"].extend(
          get_name_and_address_tables(
              objects, number_of_expansions=inline_review_blocks_to_generate
          )
      )
  review_yaml["review"].extend(review_tables)

  review_yaml_dumped = yaml.dump_all(review_yaml)
---
event: results
question: |
subquestion: |  
  ${ indent(review_yaml_dumped,4) } 
  